# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫—É—Ä—Å—ã —á–µ—Ä–µ–∑ Crypto Pay API

## –î–∞—Ç–∞: 18 –Ω–æ—è–±—Ä—è 2025

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

## 1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç** ‚≠ê

### –ß—Ç–æ –±—ã–ª–æ:
- ‚ùå –†—É—á–Ω–æ–π –≤–≤–æ–¥ –∫—É—Ä—Å–∞ `asset_rate` –≤ –∞–¥–º–∏–Ω–∫–µ
- ‚ùå –ù—É–∂–Ω–æ –±—ã–ª–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –∫—É—Ä—Å –≤—Ä—É—á–Ω—É—é
- ‚ùå –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ –æ—à–∏–±–∫–∏ –ø—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏

### –ß—Ç–æ —Å—Ç–∞–ª–æ:
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –∫—É—Ä—Å–æ–≤** —á–µ—Ä–µ–∑ Crypto Pay API
- ‚úÖ –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –∫—É—Ä—Å—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–æ–≤: USDT, TON, BTC, ETH, LTC, BNB, TRX, USDC
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–≤–µ—Ä—Å–∏—è –∫—É—Ä—Å–∞ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

---

## 2. **–ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è `get_effective_asset_rate()`**

–§—É–Ω–∫—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∞–∫—Ç–∏–≤ (–µ—Å–ª–∏ USDT, –∫—É—Ä—Å = 1.0)
2. –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ Crypto Pay API
3. –ü–æ–ª—É—á–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –∫—É—Ä—Å —á–µ—Ä–µ–∑ `getExchangeRates`
4. –ò—â–µ—Ç –ø—Ä—è–º–æ–π –∫—É—Ä—Å `ASSET/USD`
5. –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—â–µ—Ç –æ–±—Ä–∞—Ç–Ω—ã–π `USD/ASSET` –∏ –∏–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç
6. –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç fallback = 1.0
7. –õ–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

```python
def get_effective_asset_rate(asset: str) -> Decimal:
    """
    –ü–æ–ª—É—á–∞–µ—Ç –∫—É—Ä—Å –∞–∫—Ç–∏–≤–∞ –∫ USDT —á–µ—Ä–µ–∑ Crypto Pay API.
    
    –ü—Ä–∏–º–µ—Ä—ã:
    - TON: ~2.5 (1 TON = 2.5 USDT)
    - BTC: ~40000 (1 BTC = 40000 USDT)
    - USDT: 1.0 (–≤—Å–µ–≥–¥–∞)
    """
```

---

## 3. **–£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–∞** üí∞

### –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ (admin_reserve_invoice):

**–î–æ:**
```
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
- –ú–∞–ª–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ –æ—Ç–≤–µ—Ç–µ
- –ù–µ—Ç –ª–æ–≥–æ–≤
```

**–ü–æ—Å–ª–µ:**
```
‚úÖ –°—á—ë—Ç –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–∞ —Å–æ–∑–¥–∞–Ω!

üí∞ –°—É–º–º–∞: 100.000 USDT
üî¢ ID —Å—á—ë—Ç–∞: 123456
üìù –û–ø–∏—Å–∞–Ω–∏–µ: –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–∞

–û–ø–ª–∞—Ç–∏—Ç–µ —Å—á—ë—Ç –ø–æ —Å—Å—ã–ª–∫–µ:
[—Å—Å—ã–ª–∫–∞]

–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã —Å—Ä–µ–¥—Å—Ç–≤–∞ –ø–æ—Å—Ç—É–ø—è—Ç –Ω–∞ –±–∞–ª–∞–Ω—Å —Ä–µ–∑–µ—Ä–≤–∞ –±–æ—Ç–∞.
```

**–í–∞–ª–∏–¥–∞—Ü–∏—è:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Å—É–º–º—ã
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Å—É–º–º–∞ > 0
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Crypto Pay
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å—á—ë—Ç
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏

---

## 4. **–£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤—ã–≤–æ–¥–∞ –∏–∑ —Ä–µ–∑–µ—Ä–≤–∞** üí∏

### –í—ã–≤–æ–¥ (admin_reserve_cashout):

**–î–æ:**
```
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–∞–ª–∞–Ω—Å–∞
- –ú–∞–ª–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- –ù–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
```

**–ü–æ—Å–ª–µ:**
```
‚úÖ –ß–µ–∫ –Ω–∞ –≤—ã–≤–æ–¥ —Å–æ–∑–¥–∞–Ω!

üí∞ –°—É–º–º–∞: 50.000 USDT
üî¢ ID —á–µ–∫–∞: 789012

–ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ —á–µ–∫ –ø–æ —Å—Å—ã–ª–∫–µ:
[—Å—Å—ã–ª–∫–∞]

‚ö†Ô∏è –ß–µ–∫ –º–æ–∂–µ—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ª—é–±–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∫—Ç–æ –ø–µ—Ä–≤—ã–º –ø–µ—Ä–µ–π–¥–µ—Ç –ø–æ —Å—Å—ã–ª–∫–µ!
```

**–£–ª—É—á—à–µ–Ω–∏—è:**
- ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –ø–µ—Ä–µ–¥ –≤—ã–≤–æ–¥–æ–º**
- ‚úÖ –ü–æ–∫–∞–∑ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞
- ‚úÖ –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –ø—É–±–ª–∏—á–Ω–æ—Å—Ç–∏ —á–µ–∫–∞
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞:**
```
‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –≤ —Ä–µ–∑–µ—Ä–≤–µ!

–î–æ—Å—Ç—É–ø–Ω–æ: 30.500 USDT
–ó–∞–ø—Ä–æ—à–µ–Ω–æ: 50.000 USDT
```

---

## 5. **–£–±—Ä–∞–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä—É—á–Ω–æ–≥–æ –∫—É—Ä—Å–∞** üóëÔ∏è

### –£–¥–∞–ª–µ–Ω–æ –∏–∑ –∞–¥–º–∏–Ω–∫–∏:
- ‚ùå –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `asset_rate` —É–±—Ä–∞–Ω–∞ –∏–∑ `ADMIN_SETTING_FIELDS`
- ‚ùå –£–¥–∞–ª–µ–Ω–∞ –∏–∑ `DEFAULT_SETTINGS`

### –¢–µ–ø–µ—Ä—å:
- ‚úÖ –ö—É—Ä—Å –ø–æ–ª—É—á–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—ã–≤–æ–¥–µ
- ‚úÖ –í—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –∫—É—Ä—Å
- ‚úÖ –ú–µ–Ω—å—à–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ = –ø—Ä–æ—â–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

---

## üìä **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:**

### –î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã –≤ `CryptoPayClient`:

```python
def get_exchange_rates(self) -> List[Dict[str, Any]]:
    """–ü–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—É—â–∏–µ –∫—É—Ä—Å—ã –æ–±–º–µ–Ω–∞ –≤–∞–ª—é—Ç"""
    return self.call("getExchangeRates")
```

### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã –∫—É—Ä—Å–æ–≤:

```python
# –í—ã–≤–æ–¥ 10 USDT –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
# –ê–∫—Ç–∏–≤ –≤—ã–ø–ª–∞—Ç—ã: TON
# –ö—É—Ä—Å TON/USD: 2.5

asset_rate = get_effective_asset_rate("TON")  # –í–µ—Ä–Ω–µ—Ç 2.5
asset_amount = 10 / 2.5 = 4.0 TON

# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏—Ç 4 TON (—ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç 10 USDT)
```

---

## üéØ **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π:**

### –î–ª—è –∞–¥–º–∏–Ω–∞:
1. ‚úÖ –ù–µ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –∫—É—Ä—Å –≤—Ä—É—á–Ω—É—é
2. ‚úÖ –í—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∫—É—Ä—Å—ã
3. ‚úÖ –ú–µ–Ω—å—à–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ = –º–µ–Ω—å—à–µ –æ—à–∏–±–æ–∫
4. ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–∞–ª–∞–Ω—Å–µ
5. ‚úÖ –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
1. ‚úÖ –°–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ã–µ –≤—ã–ø–ª–∞—Ç—ã –ø–æ –∞–∫—Ç—É–∞–ª—å–Ω–æ–º—É –∫—É—Ä—Å—É
2. ‚úÖ –ù–µ—Ç –ø–æ—Ç–µ—Ä—å –∏–∑-–∑–∞ —É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ –∫—É—Ä—Å–∞
3. ‚úÖ –ë—ã—Å—Ç—Ä—ã–µ –≤—ã–ø–ª–∞—Ç—ã

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:
1. ‚úÖ –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏
2. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫
3. ‚úÖ Fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã
4. ‚úÖ –ß–∏—Ç–∞–µ–º—ã–π –∫–æ–¥

---

## üîß **–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**

1. **–ü—Ä–∏ –≤—ã–≤–æ–¥–µ —Å—Ä–µ–¥—Å—Ç–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:**
   ```
   –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—Ä–æ—Å–∏–ª: 10 USDT
   –ê–∫—Ç–∏–≤ –≤—ã–ø–ª–∞—Ç—ã: TON
   ‚Üí API –ø–æ–ª—É—á–∞–µ—Ç –∫—É—Ä—Å TON
   ‚Üí –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç 10 USDT –≤ TON
   ‚Üí –°–æ–∑–¥–∞–µ—Ç —á–µ–∫ –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—É–º–º—É TON
   ```

2. **–ü—Ä–∏ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–∏ –±–∞–ª–∞–Ω—Å–∞:**
   ```
   –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–Ω–æ—Å–∏—Ç: 5 TON
   ‚Üí API –ø–æ–ª—É—á–∞–µ—Ç –∫—É—Ä—Å TON  
   ‚Üí –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤ USDT
   ‚Üí –ó–∞—á–∏—Å–ª—è–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—É–º–º—É USDT
   ```

---

## ‚ö†Ô∏è **–í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è:**

1. **–¢—Ä–µ–±—É–µ—Ç—Å—è Crypto Pay —Ç–æ–∫–µ–Ω** –¥–ª—è —Ä–∞–±–æ—Ç—ã –∫—É—Ä—Å–æ–≤
2. **Fallback –∫—É—Ä—Å = 1.0** –µ—Å–ª–∏ API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
3. **–õ–æ–≥–∏** –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞** –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –≤—ã–≤–æ–¥–æ–º

---

## üìù **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**

–¢–µ–ø–µ—Ä—å –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –∫—É—Ä—Å–æ–≤: `–ü–æ–ª—É—á–µ–Ω –∫—É—Ä—Å TON/USD: 2.5`
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Å—á–µ—Ç–æ–≤: `–°–æ–∑–¥–∞–Ω —Å—á—ë—Ç –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–∞: 123456, —Å—É–º–º–∞: 100 USDT`
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —á–µ–∫–æ–≤: `–°–æ–∑–¥–∞–Ω —á–µ–∫ –≤—ã–≤–æ–¥–∞ –∏–∑ —Ä–µ–∑–µ—Ä–≤–∞: 789012, —Å—É–º–º–∞: 50 USDT`
- ‚úÖ –û—à–∏–±–∫–∏ API: `–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫—É—Ä—Å–∞ —á–µ—Ä–µ–∑ Crypto Pay API: ...`

---

## ‚úÖ **–ò—Ç–æ–≥:**

### –ë—ã–ª–æ:
- –†—É—á–Ω–æ–π –≤–≤–æ–¥ –∫—É—Ä—Å–∞
- –†–∏—Å–∫ –æ—à–∏–±–æ–∫
- –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∫—É—Ä—Å—ã

### –°—Ç–∞–ª–æ:
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∫—É—Ä—Å—ã
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- ‚úÖ –ü–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–ë–æ—Ç —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω!** üöÄ

